#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <fcntl.h>
#include <sys/stat.h>
#include "sylib.h"
#define outfile "x_one.scratch"
struct holder{ //custom type; must be declared before even prototype usage
  char *pt1;
  char *pt2; 
};
char *charSetMemAtIndex(char *, char, int);
char *strSetMemAtIndex(char *pt, char *);
char *builder(struct holder *a, char *, char *);
void printer(char *);
void writer(char *);
char *makeStr(char, int);


int main(int argc, char *argv[]){
   if(argc<2){printf("USAGE: %s string\n", argv[0]);exit(0);}
   char arr[200], *built, *ar0, *ar1;
   ar0 = argv[0], ar1=argv[1];
   struct holder pan, *panhandle;
   panhandle = &pan;
   panhandle->pt1 = arr, panhandle->pt2 = arr;
   
   // init char arr and docket
   memset(panhandle->pt1, '\x20', 200);
   
   // 12 'A's, increment the indexer
   panhandle->pt2 = charSetMemAtIndex(panhandle->pt2, '\x41', 12);
   printf("%s\n", panhandle->pt1);

   // 24 'B's, increment the indexer
   panhandle->pt2 = charSetMemAtIndex(panhandle->pt2, '\x42', 24);
   printf("%s\n", panhandle->pt1);

   // arblen argv[1], increment the indexer
   panhandle->pt2 = strSetMemAtIndex(panhandle->pt2, argv[1]);
   printf("%s\n", panhandle->pt1); 
   
   //build, print, and write, struct stats
   built = builder(panhandle, ar0, ar1);
   printer(built);
   writer(built);
   return(0);
}

char *charSetMemAtIndex(char *pt, char c, int n){
   /* memset(index, '\x41', 23);
    * index = (char *)index + 23;
   */
   memset(pt, c, n);
   pt = (char *)pt + n;
   return pt;
}

char *strSetMemAtIndex(char *pt, char *s){
   /* strcpy(index, "string");
    * index = (char *)index + strlen("string");
   */
   strcpy(pt, s);
   pt = (char *)pt + strlen(s);
   return pt;
}

void printer(char *b){
   printf("%s",b);
}

void writer(char *b){
   int fd;
   fd = open(outfile, O_WRONLY|O_CREAT|O_TRUNC, S_IRUSR|S_IWUSR);
   if (fd == -1){
      fe("Issue when trying to open the outfile");
   }
   if(write(fd, b, strlen(b)) == -1){
      fe("Issue when trying to write to the outfile");
   }
   if(close(fd) == -1){
      fe("Issue when closing the outfile");
   }
      
}

char *builder(struct holder *a, char *ar0, char *ar1){
   char temp[1600];
   char c[1600], *b;
   b = c;
   memset(b, '\x00', 1000);
   sprintf(temp, "%s\n", makeStr('\x23', strlen(a->pt1)));
   strcat(b, temp);
   sprintf(temp, "** Stats for Nerdz **\nargv[0]: %s\nargv[1] %s\nOutfile: %s\n", ar0, ar1, outfile);
   strcat(b, temp);
   sprintf(temp, "strlen total char arr: %d\n", strlen(a->pt1));
   strcat(b, temp);
   sprintf(temp, "Pointer 1 (base): %p:\n%s\n", a->pt1, a->pt1);
   strcat(b, temp);
   sprintf(temp, "Pointer 2 (iter): %p:\n%s\n", a->pt2, a->pt2);
   strcat(b, temp);
   sprintf(temp, "%s\n", makeStr('\x23', strlen(a->pt1)));
   strcat(b, temp);
   return b;
}

char *makeStr(char x, int len){
   char z[1000], *pt;
   pt = z;
   memset(pt, '\x00', 1000);
   memset(pt, x, len);
   pt = z;
   return pt;
}
