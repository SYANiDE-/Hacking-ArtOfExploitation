#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <fcntl.h>
#include <sys/stat.h>
#include "sylib.h"

int main(int argc, char *argv[]){
   if(argc< 2){
      printf("Appends string to file\n");
      printf("USAGE: %s [file] [string]\n", argv[0]);
      exit(0);
   }
   int fd;
   char *buf, *file;
   buf = (char *) chk_malloc(256);
   file = (char *) chk_malloc(40);
   strcpy(file, argv[1]);
   strcpy(buf, argv[2]);
   strncat(buf, "\n", 1);
   printf("BUF %p %s\n", buf, buf);
   printf("FILE %p %s\n", file, file);
   fd = open(file, O_WRONLY|O_CREAT|O_APPEND, S_IRUSR|S_IWUSR);
   if(fd == -1){
      fe("in main() on file load");
   }
   printf("fd is %d\n", fd);
   if(write(fd, buf, strlen(buf)) == -1){
      fe("in main() on file write");
   }
   if(close(fd) == -1){
      fe("in main() on file close");
   }
   free(file);
   free(buf);
   return(0);
}
