#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <netdb.h>
#include "sylib.h"
#include "sylib-net.h"

int main(int argc, char *argv[]){
   int fdesc;
   struct hostent *host_info;
   struct sockaddr_in targ_addr;
   unsigned char buf[4096];
   if(argc < 2){printf("USAGE %s [fqdn]\n", argv[0]);exit(-1);}
   if((host_info = gethostbyname(argv[1])) == NULL){fe("name lookup");}
   if((fdesc = socket(PF_INET, SOCK_STREAM, 0)) == -1){fe("Socket");}
   targ_addr.sin_family = AF_INET;
   targ_addr.sin_port = htons(80);
   targ_addr.sin_addr = *((struct in_addr *)(host_info->h_addr));
   memset(&(targ_addr.sin_zero), '\0', 8);
   if(connect(fdesc, (struct sockaddr *)&targ_addr, sizeof(struct sockaddr)) == -1){
      fe("at connecting");
   }
   sendBytes(fdesc, "HEAD / HTTP/1.0\r\n\r\n");
   while(recvCRLF(fdesc, buf)){
      if(strncasecmp(buf, "Server:", 7) == 0){
         printf("%s %s %s\n", argv[1], inet_ntoa(*(struct in_addr *)host_info->h_addr), buf+8);
         exit(0);
      }
   }
   printf("No lines found");
   exit(1);
}
